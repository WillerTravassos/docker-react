version: "3"

services:
  client-app:
    build:
      # Allow us to point to a non standard dockerfile
      # context allows us to point to the folder contains our dockerfile
      context: .
      dockerfile: development.dockerfile
    ports:
      - "8000:3000"
    restart: on-failure
    volumes:
      - "/client-app/node_modules"
      - "./:/client-app"

  # NOTE: this test service can also be run from the command line like this, docker exec -it container_id npm run test
  # Using an extra service does not make the command line obsolete, but just helps automate our testing process a bit
  # The down side of this approach is that we don't have the same level of control in our tests as we did in the command line,
  # i.e., we can't run any of the stdin test commands that are generated by create-react-app
  client-app-tests:
    build:
      # Allow us to point to a non standard dockerfile
      # context allows us to point to the folder contains our dockerfile
      context: .
      dockerfile: development.dockerfile
    volumes:
      - "/client-app/node_modules"
      - "./:/client-app"
    command: ["npm", "run", "test"]
